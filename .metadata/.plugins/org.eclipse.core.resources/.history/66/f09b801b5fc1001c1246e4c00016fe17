package FileHandling;
import java.util.*;
import java.io.*;
public class Registeration {
	static Scanner scanner = new Scanner(System.in);
	
	//check the password if password matches return the credentials
	public String checkPassWord(String userName, String passWord, String confirmPassWord)
	{
		
		if(passWord.equals(confirmPassWord))
		{
		String credentials = userName+"  "+passWord;
		return credentials;
		}
		else
		{
			String credentials="";
			System.out.println("Password doesn't match with confirm password");
			return credentials;
		}
	}
	public void createNewAccount() throws FileNotFoundException {
		// TODO Auto-generated method stub
		String userName, passWord, confirmPassWord;
		System.out.println("Enter User Name: ");
		userName = scanner.nextLine();
		System.out.println("Enter PassWord: ");
		passWord = scanner.nextLine();
		System.out.println("Confirm PassWord: ");
		confirmPassWord = scanner.nextLine();
		
		userName=userName.trim();
		passWord = passWord.trim();
		confirmPassWord = confirmPassWord.trim();
		String credentials = userName+"  "+passWord;
		//if the password matches and the credentials is not empty
		if(checkPassWord(userName, passWord, confirmPassWord)!="")
		{
			
			//System.out.println("done");
			File file = new File("Registeration.txt");
			Scanner fileContent = new Scanner(file);
			int flag =0;
			while(fileContent.hasNextLine())
			{
				String contentLineInFile = fileContent.nextLine();
				System.out.println(contentLineInFile);
				System.out.println(credentials);
				if(contentLineInFile.equals(credentials))
				{
					System.out.println("You are already registered");
					flag =1;
					Main.printMainMenu();
				}
			}
			if(flag==0)

			{
				try {
                    BufferedWriter writer = new BufferedWriter(new FileWriter("Registeration.txt", true)); 
                    writer.write(userName+"  "+passWord+"\n");
                    writer.close();
                }
                catch (IOException e) {
                    System.out.println("exception occoured" + e);
                }
                 
                System.out.println("Successfully Registered");
                //add the details to userdetails file
                addToUserDetails(userName);
                //System.out.println("Enter your Starting Balance:");
                //int balance = scanner.nextInt();
                
                System.out.println("Please login");
                if(loginAccount())
                {
                	//bankMenu bank =	new bankMenu(userName);	
                }
			}
			
		}
		else
		{
			System.out.println("Recheck");
			Main.printMainMenu();
		}
	}
	public static HashMap<String,Integer> addToUserDetails(String userName) {
		// TODO Auto-generated method stub
		HashMap<String, Integer> userMap = new HashMap<String,Integer>();
		System.out.println("Enter your Starting Balance:");
        int balance = scanner.nextInt();
        userMap.put(userName,balance);
        //creating file
		File userfile = new File("userDetails.txt");
        try {
    		if(userfile.createNewFile())
    		{
    			System.out.println("File created successfully");
    		}

    	} catch (IOException e) {
    		// TODO Auto-generated catch block
    		System.out.println("File cannot be created");
    		e.printStackTrace();
    	}
        
        //adding
        try {
            BufferedWriter writer = new BufferedWriter(new FileWriter("userDetails.txt", true)); 
            writer.write(userMap+"\n");
            writer.close();
        }
        catch (IOException e) {
            System.out.println("exception occoured" + e);
        }
		System.out.println("Please Login");
		loginAccount(userMap);
		
	}
	public static void loginAccount(HashMap<String,Integer> userMap) {
		// TODO Auto-generated method stub
		String userName, passWord, confirmPassWord;
		System.out.println("Enter User Name: ");
		userName = scanner.nextLine();
		System.out.println("Enter PassWord: ");
		passWord = scanner.nextLine();
		System.out.println("Confirm PassWord: ");
		confirmPassWord = scanner.nextLine();
		
		userName=userName.trim();
		passWord = passWord.trim();
		confirmPassWord = confirmPassWord.trim();
		String credentials = userName+"  "+passWord;
		try {
			File file = new File("Registeration.txt");
			Scanner fileContent = new Scanner(file);
			int flag =0;
			while(fileContent.hasNextLine())
			{
				String contentLineInFile = fileContent.nextLine();
				if(contentLineInFile.equals(credentials))
				{
					flag=1;
					System.out.println("Login Successfull");
					
					break;
				}
			}
			if(flag==0)
			{
				System.out.println("Login Failed");
				Main.printMainMenu();
			}
			
		}
		catch(FileNotFoundException e)
		{
			System.out.println("Exception occured");
			e.printStackTrace();
		}
		
	}

}
